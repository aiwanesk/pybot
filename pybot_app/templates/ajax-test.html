{% extends "layout.html" %}  

{% block ajax %}

<div id="bot-answer"></div>
<div id="mapid"></div>

<form method="POST">
    <input type="text" />
    <input type="submit" name="Submit">
</form>

<!-- Ajax call -->
<script type="text/javascript">
    $(document).ready(function(){

        var mymap;

        $("form").submit(function(e){
            //$("#test").html('<img src="{{ url_for('static', filename='loading.gif') }}">');
            e.preventDefault();

            var address_request = $("input").val()

            $.post('/ajax-osm', {
                address_request : address_request
            }).done(function(response){
                
                if (response['address']){
                    var latitude = response['address']['latitude'];
                    var longitude = response['address']['longitude'];

                    if (typeof mymap !== 'undefined'){
                        mymap.remove();  
                    }

                    mymap = L.map('mapid').setView([latitude, longitude], 15);

                    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibXZiLWhkZiIsImEiOiJjams1ZTdlNXQxN3lpM2txcXBlMHM1a3I0In0.T77BUlkk9mb8FDqlKRS3ZA', {
                        maxZoom: 18,
                        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                            'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                        id: 'mapbox.streets',
                    }).addTo(mymap);
                }
                else{
                    $('#bot-answer').append('<p>Malheureusement, il semble que cet endroit ne soit pas encore repertorié sur OpenStreetMap. Nhésite pas à contribuer en le rajoutant toi-même : </p>');
                    $('#bot-answer').append('<a href="https://www.openstreetmap.org/" target="_blank">https://www.openstreetmap.org/</a>');
                }



                console.log(response['address'])
            }).fail(function(response){
                //console.log(response['error'])
                console.log(response)

            });
        });
    });
</script>

{% endblock %}
